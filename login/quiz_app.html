<!--
  Simple Offline CSV Quiz App (No Server Needed)
  ------------------------------------------------
  • Open this HTML file directly in your browser (file://…).
  • Click "Choose CSV" and select your quiz CSV (must have columns: Question, A, B, C, D, Answer).
  • The quiz runs entirely in‑browser via FileReader & PapaParse.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Offline CSV Quiz</title>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    :root {
      --primary: #2563eb;
      --correct: #16a34a;
      --incorrect: #dc2626;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f5f6fa;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    /* Loader / File‑picker panel */
    #loader {
      text-align: center;
      background: #fff;
      padding: 2rem 3rem;
      border-radius: 0.75rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    #fileInput {
      padding: 0.6rem 1rem;
      border: 2px dashed var(--primary);
      border-radius: 0.5rem;
      cursor: pointer;
      background: #eef2ff;
    }

    /* Quiz card */
    #quiz-card {
      background: #fff;
      border-radius: 0.75rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      width: min(90%, 620px);
      padding: 2rem;
      display: none; /* shown after CSV loads */
      flex-direction: column;
      gap: 1.25rem;
    }

    #question-number {
      font-size: 1.1rem;
      font-weight: 600;
      color: #666;
    }

    #question-text {
      font-size: 1.3rem;
      font-weight: 700;
    }

    .choice-btn {
      padding: 0.75rem 1rem;
      border: 2px solid #ddd;
      border-radius: 0.5rem;
      cursor: pointer;
      background: #fafafa;
      text-align: left;
      transition: border-color 0.2s, background 0.2s;
      width: 100%;
    }

    .choice-btn:hover {
      background: #f0f0f0;
    }

    .choice-selected.correct {
      border-color: var(--correct);
      background: #dcfce7;
    }

    .choice-selected.incorrect {
      border-color: var(--incorrect);
      background: #fee2e2;
    }

    #feedback {
      font-size: 1.1rem;
      font-weight: 600;
    }

    #nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
    }

    #nav-buttons button {
      padding: 0.6rem 1.4rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      cursor: pointer;
      background: var(--primary);
      color: #fff;
      transition: opacity 0.2s;
    }

    #nav-buttons button[disabled] {
      opacity: 0.4;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <!-- File picker screen -->
  <div id="loader">
    <h2>Select a Quiz CSV to Begin</h2>
    <input type="file" id="fileInput" accept=".csv" />
    <p style="font-size:0.9rem;color:#666;margin:0">CSV must include columns: <code>Question, A, B, C, D, Answer</code></p>
  </div>

  <!-- Quiz card (hidden until CSV loads) -->
  <div id="quiz-card">
    <div id="question-number"></div>
    <div id="question-text"></div>
    <div id="choices"></div>
    <div id="feedback"></div>
    <div id="nav-buttons">
      <button id="backBtn" disabled>Back</button>
      <button id="nextBtn" disabled>Next</button>
    </div>
  </div>

  <script>
/* -----------------------------------------------------------------------
   1.  BUILT-IN QUIZ LIST  ( placeholder replaced by the workflow )
   --------------------------------------------------------------------- */
const BUILT_IN_QUIZZES = "__CSV_LIST__".split(",").filter(Boolean);

/* -----------------------------------------------------------------------
   2.  UI elements ( reuse existing loader/inputs )
   --------------------------------------------------------------------- */
const quizSelect = document.createElement("select");
quizSelect.style.padding = "0.6rem";
quizSelect.style.border  = "2px solid #2563eb";
quizSelect.style.borderRadius = "0.5rem";
quizSelect.style.cursor = "pointer";
quizSelect.style.background = "#eef2ff";
quizSelect.id = "quizSelect";

const fileInput = document.createElement("input");
fileInput.type = "file";
fileInput.accept = ".csv";
fileInput.id = "fileInput";
fileInput.style.display = "none";            // toggled later

/* Inject the dropdown just above the old <input type=file> */
const loader = document.getElementById("loader");
loader.insertBefore(quizSelect, loader.firstChild);
loader.insertBefore(document.createElement("br"), quizSelect.nextSibling);
loader.insertBefore(fileInput, quizSelect.nextSibling);

/* -----------------------------------------------------------------------
   3.  Build & populate the dropdown
   --------------------------------------------------------------------- */
function niceLabel(filename){
  return filename
    .replace(/\.csv$/i, "")   // drop extension
    .replace(/ - .*$/i, "")   // drop anything after " - "
    .trim();
}

function fillSelect(){
  /* Built-ins */
  BUILT_IN_QUIZZES.forEach(f=>{
    const opt=document.createElement("option");
    opt.value=f;
    opt.textContent=niceLabel(f);      // <-- human-friendly label
    quizSelect.appendChild(opt);
  });
  /* Upload option */
  const uploadOpt=document.createElement("option");
  uploadOpt.value="__upload__";
  uploadOpt.textContent="Upload your own CSV…";
  quizSelect.appendChild(uploadOpt);

  quizSelect.selectedIndex=-1;         // nothing pre-selected
}
fillSelect();

/* -----------------------------------------------------------------------
   4.  Enable / disable UI and wire up start behaviour
   --------------------------------------------------------------------- */
const startBtn=document.createElement("button");
startBtn.textContent="Start Quiz";
startBtn.className="start-btn";
startBtn.style.padding="0.6rem 1.3rem";
startBtn.style.border="none";
startBtn.style.background="#2563eb";
startBtn.style.color="#fff";
startBtn.style.borderRadius="0.5rem";
startBtn.style.cursor="pointer";
startBtn.disabled=true;
loader.appendChild(startBtn);

quizSelect.addEventListener("change",()=>{
  const own = quizSelect.value==="__upload__";
  fileInput.style.display = own?"block":"none";
  startBtn.disabled = own ? !fileInput.files.length : false;
});
fileInput.addEventListener("change",()=>startBtn.disabled = !fileInput.files.length);

/* Existing refs for quiz logic ----------------------------------------- */
const quizCard   = document.getElementById("quiz-card");
const numberEl   = document.getElementById("question-number");
const questionEl = document.getElementById("question-text");
const choicesEl  = document.getElementById("choices");
const feedbackEl = document.getElementById("feedback");
const backBtn    = document.getElementById("backBtn");
const nextBtn    = document.getElementById("nextBtn");

let quizData=[],currentIndex=0,answered=false;

/* -------------------- Loaders */
function loadBuiltIn(filename){
  fetch(encodeURIComponent(filename))
    .then(r=>r.text())
    .then(processCSV)
    .catch(err=>alert("Fetch error: "+err));
}
function loadUploaded(file){
  const reader=new FileReader();
  reader.onload=e=>processCSV(e.target.result);
  reader.readAsText(file);
}

/* Click “Start Quiz” */
startBtn.addEventListener("click",()=>{
  if(quizSelect.value==="__upload__"){
    loadUploaded(fileInput.files[0]);
  }else{
    loadBuiltIn(quizSelect.value);
  }
});

/* -------------------- CSV → questions */
function processCSV(csvText){
  try{
    const parsed=Papa.parse(csvText,{header:true,skipEmptyLines:true,
      transformHeader:h=>h.trim()});
    quizData=parsed.data.filter(r=>r.Question?.trim());
    if(!quizData.length) throw new Error("Empty or bad CSV");
    loader.style.display="none"; quizCard.style.display="flex";
    currentIndex=0; renderQuestion();
  }catch(e){alert("CSV error: "+e.message);}
}

/* -------------------- Render / nav (unchanged from your file) */
function renderQuestion(){
  answered=false; feedbackEl.textContent="";
  const q=quizData[currentIndex];
  numberEl.textContent=`Question ${currentIndex+1} of ${quizData.length}`;
  questionEl.textContent=q.Question;
  choicesEl.innerHTML="";
  ["A","B","C","D"].forEach(k=>{
    const txt=q[k]; if(!txt) return;
    const btn=document.createElement("button");
    btn.className="choice-btn";
    btn.innerHTML=`<strong>${k}.</strong> ${txt}`;
    btn.onclick=()=>selectAnswer(btn,k,q.Answer?.trim());
    choicesEl.appendChild(btn);
  });
  backBtn.disabled=currentIndex===0;
  nextBtn.disabled=currentIndex===quizData.length-1;
}
function selectAnswer(btn,k,correct){
  if(answered) return; answered=true;
  choicesEl.querySelectorAll(".choice-btn").forEach(b=>b.disabled=true);
  if(k===correct){
    btn.classList.add("choice-selected","correct");
    feedbackEl.textContent="✅ Correct!"; feedbackEl.style.color="var(--correct)";
  }else{
    btn.classList.add("choice-selected","incorrect");
    feedbackEl.textContent=`❌ Incorrect. Correct answer: ${correct}.`;
    feedbackEl.style.color="var(--incorrect)";
  }
}
backBtn.onclick=()=>{if(currentIndex>0){currentIndex--;renderQuestion();}};
nextBtn.onclick=()=>{if(currentIndex<quizData.length-1){currentIndex++;renderQuestion();}};
</script>

</body>
</html>
