<!--
  Simple Offline CSV Quiz App (No Server Needed)
  ------------------------------------------------
  • Open this HTML file directly in your browser (file://…).
  • Click "Choose CSV" and select your quiz CSV (must have columns: Question, A, B, C, D, Answer).
  • The quiz runs entirely in‑browser via FileReader & PapaParse.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Offline CSV Quiz</title>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    :root {
      --primary: #2563eb;
      --correct: #16a34a;
      --incorrect: #dc2626;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f5f6fa;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    /* Loader / File‑picker panel */
    #loader {
      text-align: center;
      background: #fff;
      padding: 2rem 3rem;
      border-radius: 0.75rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    #fileInput {
      padding: 0.6rem 1rem;
      border: 2px dashed var(--primary);
      border-radius: 0.5rem;
      cursor: pointer;
      background: #eef2ff;
    }

    /* Quiz card */
    #quiz-card {
      background: #fff;
      border-radius: 0.75rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      width: min(90%, 620px);
      padding: 2rem;
      display: none; /* shown after CSV loads */
      flex-direction: column;
      gap: 1.25rem;
    }

    #question-number {
      font-size: 1.1rem;
      font-weight: 600;
      color: #666;
    }

    #question-text {
      font-size: 1.3rem;
      font-weight: 700;
    }

    .choice-btn {
      padding: 0.75rem 1rem;
      border: 2px solid #ddd;
      border-radius: 0.5rem;
      cursor: pointer;
      background: #fafafa;
      text-align: left;
      transition: border-color 0.2s, background 0.2s;
      width: 100%;
    }

    .choice-btn:hover {
      background: #f0f0f0;
    }

    .choice-selected.correct {
      border-color: var(--correct);
      background: #dcfce7;
    }

    .choice-selected.incorrect {
      border-color: var(--incorrect);
      background: #fee2e2;
    }

    #feedback {
      font-size: 1.1rem;
      font-weight: 600;
    }

    #nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
    }

    #nav-buttons button {
      padding: 0.6rem 1.4rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      cursor: pointer;
      background: var(--primary);
      color: #fff;
      transition: opacity 0.2s;
    }

    #nav-buttons button[disabled] {
      opacity: 0.4;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <!-- File picker screen -->
  <div id="loader">
    <h2>Select a Quiz CSV to Begin</h2>
    <input type="file" id="fileInput" accept=".csv" />
    <p style="font-size:0.9rem;color:#666;margin:0">CSV must include columns: <code>Question, A, B, C, D, Answer</code></p>
  </div>

  <!-- Quiz card (hidden until CSV loads) -->
  <div id="quiz-card">
    <div id="question-number"></div>
    <div id="question-text"></div>
    <div id="choices"></div>
    <div id="feedback"></div>
    <div id="nav-buttons">
      <button id="backBtn" disabled>Back</button>
      <button id="nextBtn" disabled>Next</button>
    </div>
  </div>

  <script>
    const fileInput  = document.getElementById("fileInput");
    const loader     = document.getElementById("loader");
    const quizCard   = document.getElementById("quiz-card");

    const numberEl   = document.getElementById("question-number");
    const questionEl = document.getElementById("question-text");
    const choicesEl  = document.getElementById("choices");
    const feedbackEl = document.getElementById("feedback");
    const backBtn    = document.getElementById("backBtn");
    const nextBtn    = document.getElementById("nextBtn");

    let quizData = [];
    let currentIndex = 0;
    let answered = false;

    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (evt) => {
        try {
          const csvText = evt.target.result;
          const parsed = Papa.parse(csvText, {
            header: true,
            skipEmptyLines: true,
            transformHeader: (h) => h.trim(),
          });

          quizData = parsed.data.filter((row) => row.Question?.trim());
          if (!quizData.length) throw new Error("CSV appears empty or mis‑formatted.");

          // Switch to quiz view
          loader.style.display = "none";
          quizCard.style.display = "flex";
          currentIndex = 0;
          renderQuestion();
        } catch (err) {
          alert("Error processing CSV: " + err.message);
        }
      };
      reader.readAsText(file);
    });

    function renderQuestion() {
      if (!quizData.length) return;
      answered = false;
      feedbackEl.textContent = "";
      const q = quizData[currentIndex];
      numberEl.textContent = `Question ${currentIndex + 1} of ${quizData.length}`;
      questionEl.textContent = q.Question;

      // Build answer choices
      choicesEl.innerHTML = "";
      const choiceKeys = ["A", "B", "C", "D"];
      choiceKeys.forEach((key) => {
        const text = q[key];
        if (!text) return; // skip empty columns
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.innerHTML = `<strong>${key}.</strong> ${text}`;
        btn.addEventListener("click", () => selectAnswer(btn, key, q.Answer?.trim()));
        choicesEl.appendChild(btn);
      });

      backBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === quizData.length - 1;
    }

    function selectAnswer(btn, selectedKey, correctKey) {
      if (answered) return;
      answered = true;
      choicesEl.querySelectorAll(".choice-btn").forEach((b) => (b.disabled = true));

      if (selectedKey === correctKey) {
        btn.classList.add("choice-selected", "correct");
        feedbackEl.textContent = "✅ Correct!";
        feedbackEl.style.color = "var(--correct)";
      } else {
        btn.classList.add("choice-selected", "incorrect");
        feedbackEl.textContent = `❌ Incorrect. Correct answer: ${correctKey}.`;
        feedbackEl.style.color = "var(--incorrect)";
      }
    }

    backBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        renderQuestion();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentIndex < quizData.length - 1) {
        currentIndex++;
        renderQuestion();
      }
    });
  </script>
</body>
</html>
